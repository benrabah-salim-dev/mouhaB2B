# Generated by Django 5.2 on 2026-01-30 15:21

import django.db.models.deletion
import django.utils.timezone
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='LanguageMapping',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('code', models.CharField(max_length=10, unique=True)),
                ('name', models.CharField(max_length=50)),
                ('mapping', models.JSONField(default=dict)),
            ],
            options={
                'ordering': ['code'],
            },
        ),
        migrations.CreateModel(
            name='TourOperateur',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('nom', models.CharField(max_length=100)),
                ('adresse', models.TextField(blank=True)),
                ('email', models.EmailField(blank=True, max_length=254, null=True)),
                ('telephone', models.CharField(blank=True, max_length=20, null=True)),
            ],
            options={
                'verbose_name': 'Tour Opérateur',
                'verbose_name_plural': 'Tour Opérateurs',
                'ordering': ['nom'],
            },
        ),
        migrations.CreateModel(
            name='Zone',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('nom', models.CharField(max_length=150)),
                ('ville', models.TextField(blank=True, null=True)),
                ('type', models.CharField(blank=True, default='circle', max_length=20, null=True)),
                ('center_lat', models.FloatField(blank=True, null=True)),
                ('center_lng', models.FloatField(blank=True, null=True)),
                ('radius_m', models.IntegerField(blank=True, null=True)),
                ('north', models.FloatField(blank=True, null=True)),
                ('south', models.FloatField(blank=True, null=True)),
                ('east', models.FloatField(blank=True, null=True)),
                ('west', models.FloatField(blank=True, null=True)),
                ('code_postal', models.CharField(blank=True, max_length=20, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True, null=True)),
            ],
            options={
                'ordering': ['nom'],
            },
        ),
        migrations.CreateModel(
            name='AgenceVoyage',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('nom', models.CharField(max_length=255, verbose_name='Raison sociale')),
                ('rne', models.CharField(blank=True, max_length=100, null=True, verbose_name='RNE')),
                ('code_fiscal', models.CharField(blank=True, max_length=100, null=True)),
                ('code_categorie', models.CharField(blank=True, max_length=100, null=True)),
                ('etab_secondaire', models.CharField(blank=True, max_length=100, null=True)),
                ('logo_file', models.ImageField(blank=True, null=True, upload_to='agencies/logos/')),
                ('pays', models.CharField(blank=True, max_length=100, null=True)),
                ('adresse', models.TextField(blank=True, default='')),
                ('email', models.EmailField(blank=True, max_length=254, null=True)),
                ('telephone', models.CharField(blank=True, max_length=50, null=True)),
                ('telephone_urgence_client', models.CharField(blank=True, max_length=50, null=True)),
                ('rep_prenom', models.CharField(blank=True, max_length=100, null=True)),
                ('rep_nom', models.CharField(blank=True, max_length=100, null=True)),
                ('rep_cin', models.CharField(blank=True, max_length=50, null=True)),
                ('rep_date_naissance', models.DateField(blank=True, null=True)),
                ('rep_email', models.EmailField(blank=True, max_length=254, null=True)),
                ('rep_phone', models.CharField(blank=True, max_length=50, null=True)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='agence', to=settings.AUTH_USER_MODEL)),
                ('tour_operateur', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='agences', to='apps.touroperateur')),
            ],
            options={
                'ordering': ['nom'],
            },
        ),
        migrations.CreateModel(
            name='AgencyApplication',
            fields=[
                ('id', models.AutoField(primary_key=True, serialize=False)),
                ('legal_name', models.CharField(max_length=255)),
                ('rne', models.CharField(max_length=100)),
                ('code_fiscal', models.CharField(max_length=100)),
                ('code_categorie', models.CharField(max_length=100)),
                ('etab_secondaire', models.CharField(max_length=100)),
                ('logo_file', models.ImageField(blank=True, null=True, upload_to='agencies/logos/')),
                ('rne_doc_file', models.FileField(blank=True, null=True, upload_to='agences/rne_docs/', verbose_name='Document RNE (PDF/image)')),
                ('patente_doc_file', models.FileField(blank=True, null=True, upload_to='agences/patente_docs/', verbose_name='Patente / Registre de commerce (PDF/image)')),
                ('company_country', models.CharField(max_length=100)),
                ('company_address', models.TextField(blank=True, default='')),
                ('company_email', models.EmailField(max_length=254)),
                ('company_phone', models.CharField(max_length=50)),
                ('rep_prenom', models.CharField(max_length=100)),
                ('rep_nom', models.CharField(max_length=100)),
                ('rep_cin', models.CharField(max_length=50)),
                ('rep_date_naissance', models.DateField(blank=True, null=True)),
                ('rep_photo_file', models.ImageField(blank=True, null=True, upload_to='agencies/reps/')),
                ('rep_email', models.EmailField(max_length=254)),
                ('rep_phone', models.CharField(max_length=50)),
                ('otp_delivery', models.CharField(choices=[('email', 'E-mail'), ('sms', 'SMS')], max_length=10)),
                ('otp_code', models.CharField(blank=True, help_text='Code saisi par le client (à valider côté plateforme / gestionnaire).', max_length=10, null=True)),
                ('otp_verified', models.BooleanField(default=False)),
                ('statut', models.CharField(choices=[('en_attente', 'En attente'), ('validee', 'Validée'), ('refusee', 'Refusée')], db_index=True, default='en_attente', max_length=20)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('decided_at', models.DateTimeField(blank=True, null=True)),
                ('agence', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='applications_origine', to='apps.agencevoyage')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='agency_applications_created', to=settings.AUTH_USER_MODEL)),
                ('decided_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='agency_applications_decided', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='AgencyOtp',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('email', models.EmailField(db_index=True, max_length=254)),
                ('code', models.CharField(max_length=6)),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
            ],
            options={
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['email', 'created_at'], name='apps_agency_email_adef28_idx')],
            },
        ),
        migrations.CreateModel(
            name='Chauffeur',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('nom', models.CharField(max_length=100)),
                ('prenom', models.CharField(max_length=100)),
                ('adresse', models.CharField(blank=True, help_text="Adresse du chauffeur (localisation courante si pas d'affectation)", max_length=255, null=True)),
                ('cin', models.CharField(max_length=20, unique=True)),
                ('statut', models.CharField(choices=[('dispo', 'Disponible'), ('occupe', 'Occupé')], default='dispo', max_length=10)),
                ('agence', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='chauffeurs', to='apps.agencevoyage')),
            ],
            options={
                'ordering': ['agence__nom', 'nom', 'prenom'],
            },
        ),
        migrations.CreateModel(
            name='ExcursionTemplate',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('nom', models.CharField(max_length=150)),
                ('description', models.TextField(blank=True)),
                ('type_duree', models.CharField(choices=[('HALF', '1/2 journée'), ('FULL', 'Journée complète'), ('MULTI', 'Plusieurs jours')], default='HALF', max_length=10)),
                ('nb_jours', models.PositiveIntegerField(default=1, help_text='Utilisé seulement si type = MULTI')),
                ('repas_inclus', models.BooleanField(default=False, help_text="Cocher si l'excursion inclut un ou plusieurs repas")),
                ('depart_label', models.CharField(blank=True, help_text='Point de départ (ex : Agence, hôtel, lieu de rendez-vous).', max_length=255, null=True)),
                ('depart_lat', models.FloatField(blank=True, null=True)),
                ('depart_lng', models.FloatField(blank=True, null=True)),
                ('depart_place_id', models.CharField(blank=True, max_length=255, null=True)),
                ('retour_lat', models.FloatField(blank=True, null=True)),
                ('retour_lng', models.FloatField(blank=True, null=True)),
                ('retour_label', models.CharField(blank=True, max_length=255, null=True)),
                ('retour_place_id', models.CharField(blank=True, max_length=255, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('agence', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='excursion_templates', to='apps.agencevoyage')),
            ],
            options={
                'ordering': ['nom'],
            },
        ),
        migrations.CreateModel(
            name='ExcursionStep',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('ordre', models.PositiveIntegerField(default=1)),
                ('nom', models.CharField(max_length=150)),
                ('adresse', models.CharField(blank=True, max_length=255, null=True)),
                ('lat', models.FloatField(blank=True, null=True)),
                ('lng', models.FloatField(blank=True, null=True)),
                ('is_meal_stop_matin', models.BooleanField(default=False)),
                ('is_meal_stop_midi', models.BooleanField(default=False)),
                ('is_meal_stop_soir', models.BooleanField(default=False)),
                ('duree_arret_minutes', models.PositiveIntegerField(default=0, help_text="Durée approximative de l'arrêt à cette étape.")),
                ('template', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='etapes', to='apps.excursiontemplate')),
            ],
            options={
                'ordering': ['template', 'ordre'],
            },
        ),
        migrations.CreateModel(
            name='Hotel',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('nom', models.CharField(max_length=100, unique=True)),
                ('adresse', models.TextField(blank=True, null=True)),
                ('lat', models.FloatField(blank=True, null=True)),
                ('lng', models.FloatField(blank=True, null=True)),
                ('place_id', models.CharField(blank=True, max_length=128, null=True)),
                ('formatted_address', models.TextField(blank=True, null=True)),
                ('agence', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='hotels', to='apps.agencevoyage')),
                ('zone', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='hotels', to='apps.zone')),
            ],
            options={
                'ordering': ['nom'],
            },
        ),
        migrations.CreateModel(
            name='FicheMouvement',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('ref', models.CharField(editable=False, max_length=50, unique=True)),
                ('type', models.CharField(max_length=1)),
                ('date', models.DateField()),
                ('horaires', models.TimeField(blank=True, null=True)),
                ('provenance', models.CharField(blank=True, max_length=100, null=True)),
                ('destination', models.CharField(blank=True, max_length=100, null=True)),
                ('numero_vol', models.CharField(blank=True, max_length=100, null=True)),
                ('client_to', models.CharField(blank=True, max_length=255, null=True)),
                ('pax', models.PositiveIntegerField(default=0)),
                ('adulte', models.PositiveIntegerField(default=0)),
                ('enfants', models.PositiveIntegerField(default=0)),
                ('bebe', models.PositiveIntegerField(default=0)),
                ('hotel_schedule', models.JSONField(blank=True, default=list, null=True)),
                ('observation', models.TextField(blank=True, null=True)),
                ('remarque', models.TextField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('agence', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='fiches_mouvement', to='apps.agencevoyage')),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='fiches_creees', to=settings.AUTH_USER_MODEL)),
                ('hotel', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='fiches', to='apps.hotel')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='Dossier',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('reference', models.CharField(blank=True, max_length=100, null=True)),
                ('type_mouvement', models.CharField(choices=[('A', 'Arrivée'), ('D', 'Départ'), ('L', 'Arrivée locale'), ('S', 'Sortie')], max_length=1)),
                ('date', models.DateField(blank=True, null=True)),
                ('horaires', models.TimeField(blank=True, null=True)),
                ('provenance', models.CharField(blank=True, max_length=100, null=True)),
                ('destination', models.CharField(blank=True, max_length=100, null=True)),
                ('numero_vol', models.CharField(blank=True, max_length=100, null=True)),
                ('client', models.CharField(blank=True, max_length=255, null=True)),
                ('titulaire', models.CharField(blank=True, max_length=255, null=True)),
                ('pax', models.PositiveIntegerField(default=0)),
                ('adulte', models.PositiveIntegerField(default=0)),
                ('enfants', models.PositiveIntegerField(default=0)),
                ('bb_gratuit', models.PositiveIntegerField(default=0)),
                ('hotel', models.CharField(blank=True, max_length=255, null=True)),
                ('is_transformed', models.BooleanField(default=False)),
                ('dossiers_refs', models.TextField(blank=True, null=True)),
                ('ville', models.CharField(blank=True, max_length=255, null=True)),
                ('code_postal', models.CharField(blank=True, max_length=20, null=True)),
                ('observation', models.TextField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('agence', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='apps.agencevoyage')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('fiche_mouvement', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='dossiers', to='apps.fichemouvement')),
                ('hotel_fk', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='apps.hotel')),
                ('zone_fk', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='apps.zone')),
            ],
        ),
        migrations.CreateModel(
            name='Mission',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('type', models.CharField(choices=[('T', 'Transfert'), ('E', 'Excursion'), ('N', 'Navette')], default='T', max_length=1)),
                ('reference', models.CharField(blank=True, max_length=50, null=True, unique=True)),
                ('date', models.DateField()),
                ('horaires', models.TimeField(blank=True, null=True)),
                ('provenance', models.CharField(blank=True, max_length=100, null=True)),
                ('destination', models.CharField(blank=True, max_length=100, null=True)),
                ('numero_vol', models.CharField(blank=True, max_length=100, null=True)),
                ('client', models.CharField(blank=True, max_length=255, null=True)),
                ('pax', models.PositiveIntegerField(default=0)),
                ('ville', models.CharField(blank=True, max_length=255, null=True)),
                ('code_postal', models.CharField(blank=True, max_length=20, null=True)),
                ('observation', models.TextField(blank=True, null=True)),
                ('aeroport', models.CharField(blank=True, max_length=100, null=True)),
                ('remarque', models.TextField(blank=True, null=True)),
                ('is_converted_from_fiche', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('agence', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='missions', to='apps.agencevoyage')),
                ('chauffeur', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='missions', to='apps.chauffeur')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='HistoriqueTransformation',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('date_transformation', models.DateTimeField(auto_now_add=True)),
                ('type_transformation', models.CharField(help_text='Ex: DOSSIER->FICHE, FICHE->MISSION', max_length=255)),
                ('dossier', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='historiques', to='apps.dossier')),
                ('fiche_de_mouvement', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='apps.fichemouvement')),
                ('transformed_by', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('mission', models.ForeignKey(blank=True, db_constraint=False, null=True, on_delete=django.db.models.deletion.SET_NULL, to='apps.mission')),
            ],
            options={
                'ordering': ['-date_transformation'],
            },
        ),
        migrations.AddField(
            model_name='fichemouvement',
            name='mission',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='fiches', to='apps.mission'),
        ),
        migrations.CreateModel(
            name='Profile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('role', models.CharField(choices=[('superadmin', 'Super Admin'), ('adminagence', 'Admin Agence')], default='adminagence', max_length=20)),
                ('agence', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='apps.agencevoyage')),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='profile', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='ReferenceSequence',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('prefix', models.CharField(max_length=10)),
                ('day', models.DateField()),
                ('last_number', models.PositiveIntegerField(default=0)),
            ],
            options={
                'indexes': [models.Index(fields=['prefix', 'day'], name='apps_refere_prefix_400357_idx')],
                'unique_together': {('prefix', 'day')},
            },
        ),
        migrations.CreateModel(
            name='Succursale',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('nom', models.CharField(max_length=100)),
                ('adresse', models.TextField(blank=True)),
                ('email', models.EmailField(blank=True, max_length=254, null=True)),
                ('telephone', models.CharField(blank=True, max_length=20, null=True)),
                ('agence', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='succursales', to='apps.agencevoyage')),
            ],
            options={
                'ordering': ['agence__nom', 'nom'],
            },
        ),
        migrations.CreateModel(
            name='Vehicule',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('type', models.CharField(choices=[('bus', 'Bus'), ('minibus', 'Minibus'), ('microbus', 'Microbus'), ('4x4', '4x4')], max_length=20)),
                ('marque', models.CharField(max_length=100)),
                ('modele', models.CharField(max_length=100)),
                ('capacite', models.PositiveIntegerField()),
                ('immatriculation', models.CharField(max_length=15, unique=True)),
                ('statut', models.CharField(choices=[('dispo', 'Disponible'), ('occupe', 'Occupé')], default='dispo', max_length=10)),
                ('adresse', models.CharField(blank=True, help_text='Adresse actuelle du véhicule (agence, hôtel, aéroport...)', max_length=255, null=True)),
                ('last_lat', models.FloatField(blank=True, null=True)),
                ('last_lng', models.FloatField(blank=True, null=True)),
                ('annee_mise_en_circulation', models.PositiveIntegerField(blank=True, help_text='Année de première mise en circulation', null=True)),
                ('louer_autres_agences', models.BooleanField(default=False, help_text='Si coché, ce véhicule peut être proposé en RENTOÛT aux autres agences')),
                ('agence', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='vehicules', to='apps.agencevoyage')),
            ],
            options={
                'ordering': ['agence__nom', 'immatriculation'],
            },
        ),
        migrations.CreateModel(
            name='RentoutRequest',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('date_debut', models.DateField()),
                ('date_fin', models.DateField()),
                ('heure_prise', models.TimeField(blank=True, null=True)),
                ('adresse_prise_en_charge', models.CharField(help_text='Adresse où le véhicule doit se présenter (client final)', max_length=255)),
                ('commentaire', models.TextField(blank=True, help_text='Précisions sur la mission (type de service, consignes, etc.)', null=True)),
                ('prix_propose', models.DecimalField(blank=True, decimal_places=2, help_text="Montant estimé d'après les tarifs (modulable si besoin)", max_digits=10, null=True)),
                ('status', models.CharField(choices=[('PENDING', 'En attente'), ('ACCEPTED', 'Acceptée'), ('REJECTED', 'Refusée'), ('CANCELLED', 'Annulée')], default='PENDING', max_length=20)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('agence_demandeuse', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='rentout_demandes', to='apps.agencevoyage')),
                ('agence_fournisseuse', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='rentout_offres', to='apps.agencevoyage')),
                ('mission', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='rentout_requests', to='apps.mission')),
                ('vehicule', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='rentout_requests', to='apps.vehicule')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.AddField(
            model_name='mission',
            name='vehicule',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='missions', to='apps.vehicule'),
        ),
        migrations.CreateModel(
            name='ExcursionEvent',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('date_debut', models.DateField()),
                ('date_fin', models.DateField(blank=True, null=True)),
                ('heure_depart', models.TimeField()),
                ('heure_retour_estimee', models.TimeField(blank=True, null=True)),
                ('repas_matin', models.BooleanField(default=False)),
                ('repas_midi', models.BooleanField(default=False)),
                ('repas_soir', models.BooleanField(default=False)),
                ('vehicle_source', models.CharField(choices=[('INTERNAL', 'Ma flotte'), ('RENTOUT', 'Rentout')], default='INTERNAL', max_length=20)),
                ('nb_participants', models.PositiveIntegerField(default=0)),
                ('statut', models.CharField(choices=[('PLANNED', 'Prévu'), ('CONFIRMED', 'Confirmé'), ('IN_PROGRESS', 'En cours'), ('DONE', 'Terminé'), ('CANCELLED', 'Annulé')], default='PLANNED', max_length=20)),
                ('notes', models.TextField(blank=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('agence', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='excursions', to='apps.agencevoyage')),
                ('chauffeur', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='excursions', to='apps.chauffeur')),
                ('template', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='events', to='apps.excursiontemplate')),
                ('mission', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='excursion_events', to='apps.mission')),
                ('vehicule_interne', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='excursions_internes', to='apps.vehicule')),
                ('vehicule_rentout', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='excursions_rentout', to='apps.vehicule')),
            ],
        ),
        migrations.CreateModel(
            name='VehiculeTarifZone',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('aeroport', models.CharField(max_length=100)),
                ('type_code', models.CharField(blank=True, choices=[('bus', 'Bus'), ('minibus', 'Minibus'), ('microbus', 'Microbus'), ('4x4', '4x4')], max_length=32, null=True)),
                ('prix', models.DecimalField(decimal_places=2, default=0, max_digits=10)),
                ('devise', models.CharField(default='TND', max_length=3)),
                ('agence', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='tarifs_vehicules_par_zone', to='apps.agencevoyage')),
                ('vehicule', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='tarifs_zones', to='apps.vehicule')),
                ('zone', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='apps.zone')),
            ],
        ),
        migrations.CreateModel(
            name='AuditLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('entity', models.CharField(db_index=True, max_length=80)),
                ('entity_id', models.PositiveIntegerField(db_index=True)),
                ('action', models.CharField(choices=[('create', 'Create'), ('update', 'Update'), ('delete', 'Delete')], db_index=True, max_length=10)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True)),
                ('changes', models.JSONField(blank=True, default=dict)),
                ('meta', models.JSONField(blank=True, default=dict)),
                ('actor', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='audit_logs', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['entity', 'entity_id', 'created_at'], name='apps_auditl_entity_20baad_idx')],
            },
        ),
        migrations.CreateModel(
            name='OrdreMission',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('base_reference', models.CharField(db_index=True, max_length=32)),
                ('version', models.PositiveIntegerField(default=1)),
                ('reference', models.CharField(db_index=True, max_length=64, unique=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('fichier_pdf', models.FileField(blank=True, null=True, upload_to='ordres_pdf/')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
                ('mission', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='ordres', to='apps.mission')),
            ],
            options={
                'ordering': ['-created_at'],
                'constraints': [models.UniqueConstraint(fields=('mission', 'version'), name='uniq_om_mission_version'), models.UniqueConstraint(fields=('base_reference', 'version'), name='uniq_om_base_version')],
            },
        ),
        migrations.CreateModel(
            name='MissionRessource',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('date_heure_debut', models.DateTimeField()),
                ('date_heure_fin', models.DateTimeField()),
                ('lieu_depart', models.CharField(blank=True, max_length=255, null=True)),
                ('lieu_arrivee', models.CharField(blank=True, max_length=255, null=True)),
                ('is_deleted', models.BooleanField(db_index=True, default=False)),
                ('deleted_at', models.DateTimeField(blank=True, null=True)),
                ('chauffeur', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='affectations', to='apps.chauffeur')),
                ('mission', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='affectations', to='apps.mission')),
                ('vehicule', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='affectations', to='apps.vehicule')),
            ],
            options={
                'ordering': ['date_heure_debut'],
                'indexes': [models.Index(fields=['is_deleted', 'date_heure_debut'], name='apps_missio_is_dele_78a4c9_idx'), models.Index(fields=['is_deleted', 'date_heure_fin'], name='apps_missio_is_dele_c25da2_idx'), models.Index(fields=['vehicule', 'is_deleted', 'date_heure_debut'], name='apps_missio_vehicul_ca10a8_idx'), models.Index(fields=['chauffeur', 'is_deleted', 'date_heure_debut'], name='apps_missio_chauffe_0133c0_idx')],
                'constraints': [models.UniqueConstraint(condition=models.Q(('is_deleted', False), ('vehicule__isnull', False)), fields=('mission', 'vehicule'), name='uniq_mission_vehicule'), models.UniqueConstraint(condition=models.Q(('chauffeur__isnull', False), ('is_deleted', False)), fields=('mission', 'chauffeur'), name='uniq_mission_chauffeur')],
            },
        ),
    ]
